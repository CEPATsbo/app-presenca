<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cronograma TV - CEPAT</title>
    <style>
        body { font-family: sans-serif; background-color: #0d47a1; color: #fff; margin: 0; padding: 2vh; overflow: hidden; height: 100vh; }
        .header-tv { text-align: center; height: 10vh; }
        .header-tv h1 { font-size: 6vh; margin: 0; text-transform: uppercase; letter-spacing: 5px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        
        .page-container { position: relative; height: 85vh; }
        .semestre-slide { 
            position: absolute; inset: 0; opacity: 0; visibility: hidden; 
            transition: opacity 1.5s ease-in-out; 
            display: flex; flex-direction: column; 
        }
        .semestre-slide.active { opacity: 1; visibility: visible; }
        
        .semestre-titulo { background: rgba(255,255,255,0.2); font-size: 4vh; padding: 1vh; border-radius: 10px; margin-bottom: 2vh; text-align: center; }
        
        .grid-meses-tv { 
            display: grid; grid-template-columns: repeat(3, 1fr); 
            gap: 2vh; flex-grow: 1; 
        }
        .caixa-mes-tv { 
            background: #fff; color: #333; border-radius: 15px; 
            padding: 2vh; display: flex; flex-direction: column; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        .caixa-mes-tv h3 { 
            margin: 0 0 1.5vh 0; font-size: 3.5vh; border-bottom: 4px solid #0d47a1; 
            color: #0d47a1; 
        }
        .lista-tv { list-style: none; padding: 0; margin: 0; overflow: hidden; }
        .item-tv { 
            padding: 1vh 0; border-bottom: 2px solid #eee; 
            font-size: 2.2vh; line-height: 1.2; 
        }
        .item-tv strong { color: #0d47a1; }
        .item-tv span { display: block; color: #666; font-size: 1.8vh; }
        .feriado-tv { color: #d32f2f !important; font-weight: bold; }
    </style>
</head>
<body>
    <div class="header-tv"><h1>Cronograma de Eventos 2026</h1></div>
    <div id="container-tv" class="page-container"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBV7RPjk3cFTqL-aIpflJcUojKg1ZXMLuU",
            authDomain: "voluntarios-ativos---cepat.firebaseapp.com",
            projectId: "voluntarios-ativos---cepat",
            storageBucket: "voluntarios-ativos---cepat.firebasestorage.app",
            messagingSenderId: "66122858261",
            appId: "1:66122858261:web:7fa21f1805463b5c08331c"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        onSnapshot(query(collection(db, "eventos"), orderBy("dataInicio", "asc")), (snapshot) => {
            const evs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderizarTV(evs);
        });

        function renderizarTV(eventos) {
            const container = document.getElementById('container-tv');
            container.innerHTML = '';
            const ano = 2026;
            const nomes = ["JANEIRO", "FEVEREIRO", "MARÇO", "ABRIL", "MAIO", "JUNHO", "JULHO", "AGOSTO", "SETEMBRO", "OUTUBRO", "NOVEMBRO", "DEZEMBRO"];

            const semestres = [
                { id: 's1', nome: '1º SEMESTRE', meses: [0,1,2,3,4,5] },
                { id: 's2', nome: '2º SEMESTRE', meses: [6,7,8,9,10,11] }
            ];

            semestres.forEach(sem => {
                const sDiv = document.createElement('div');
                sDiv.className = 'semestre-slide';
                sDiv.id = sem.id;
                sDiv.innerHTML = `<div class="semestre-titulo">${sem.nome}</div><div class="grid-meses-tv"></div>`;
                
                const grid = sDiv.querySelector('.grid-meses-tv');
                sem.meses.forEach(mIdx => {
                    const caixa = document.createElement('div');
                    caixa.className = 'caixa-mes-tv';
                    caixa.innerHTML = `<h3>${nomes[mIdx]}</h3><ul class="lista-tv"></ul>`;
                    
                    const lista = caixa.querySelector('ul');
                    const evsMes = eventos.filter(ev => {
                        const d = ev.dataInicio.toDate();
                        return d.getFullYear() === ano && d.getUTCMonth() === mIdx && ev.status !== 'cancelado';
                    });

                    evsMes.forEach(ev => {
                        const d = ev.dataInicio.toDate();
                        const li = document.createElement('li');
                        li.className = 'item-tv';
                        const cl = ev.tipo === 'feriado' ? 'feriado-tv' : '';
                        li.innerHTML = `<strong class="${cl}">${d.getUTCDate().toString().padStart(2,'0')}/${(mIdx+1).toString().padStart(2,'0')} - ${ev.titulo}</strong>
                                        <span>${ev.detalhes || ''}</span>`;
                        lista.appendChild(li);
                    });
                    grid.appendChild(caixa);
                });
                container.appendChild(sDiv);
            });

            // Alternância de Semestres
            let atual = 0;
            const slides = document.querySelectorAll('.semestre-slide');
            const trocar = () => {
                slides.forEach(s => s.classList.remove('active'));
                slides[atual].classList.add('active');
                atual = (atual + 1) % slides.length;
            };
            trocar(); setInterval(trocar, 15000); // 15 segundos cada semestre
        }
    </script>
</body>
</html>