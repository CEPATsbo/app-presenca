<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel de Escalas CEPAT - Acesso Voluntários</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #080808; --card: #151515; --green: #27ae60; --orange: #d35400; --white: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--white); margin: 0; padding: 20px; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        .header-painel { display: flex; justify-content: space-between; align-items: center; padding: 20px 40px; background: var(--card); border-radius: 15px; border-bottom: 6px solid var(--green); margin-bottom: 20px; }
        .grid-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; flex-grow: 1; }
        .coluna { background: var(--card); border-radius: 20px; padding: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.6); }
        
        .titulo-secao { font-size: 2.2em; border-bottom: 2px solid #333; padding-bottom: 15px; margin-bottom: 25px; font-weight: bold; text-transform: uppercase; display: flex; align-items: center; gap: 15px; }
        .tema-destaque { background: #1c1c1c; padding: 20px; border-radius: 12px; border-left: 10px solid var(--orange); margin-bottom: 30px; }
        .tema-destaque h3 { margin: 0; font-size: 1em; color: var(--orange); }
        .tema-destaque p { margin: 10px 0 0 0; font-size: 1.7em; font-weight: bold; font-style: italic; }

        .linha-voluntario { border-bottom: 1px solid #222; padding: 15px 0; display: flex; flex-direction: column; }
        .linha-voluntario label { color: #888; font-size: 0.9em; text-transform: uppercase; font-weight: bold; }
        .linha-voluntario span { font-size: 1.6em; margin-top: 5px; color: #eee; }

        .relogio-container { text-align: right; }
        .relogio { font-size: 2.8em; font-weight: bold; color: var(--green); font-family: 'Courier New', monospace; }
        .data-extenso { color: #888; font-size: 1.2em; text-transform: capitalize; }
        
        #aviso-erro { display: none; background: #c0392b; color: white; padding: 10px; text-align: center; font-weight: bold; border-radius: 5px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="aviso-erro">Erro de sincronização. Verifique a conexão.</div>

    <header class="header-painel">
        <div>
            <h1 style="margin:0; font-size: 2.4em;">ESCALA DE TRABALHO</h1>
            <div class="data-extenso" id="display-data">Carregando...</div>
        </div>
        <div class="relogio-container">
            <div class="relogio" id="display-hora">00:00:00</div>
        </div>
    </header>

    <main class="grid-layout">
        <section class="coluna">
            <div class="titulo-secao" style="color: var(--orange);">
                <i class="fas fa-hand-holding-heart"></i> Cáritas
            </div>
            <div id="dados-caritas">
                <div class="tema-destaque">
                    <h3>Tema da Preleção</h3>
                    <p id="caritas-tema">Buscando escala...</p>
                </div>
                <div class="linha-voluntario"><label>Preletor(a)</label><span id="caritas-preletor">--</span></div>
                <div class="linha-voluntario"><label>Entrevistador(a)</label><span id="caritas-entrevistador">--</span></div>
                <div class="linha-voluntario"><label>Escola de Pais / Evangelização</label><span id="caritas-apoio">--</span></div>
            </div>
        </section>

        <section class="coluna">
            <div class="titulo-secao" style="color: var(--green);">
                <i class="fas fa-dove"></i> Espiritual
            </div>
            <div class="tema-destaque" style="border-left-color: var(--green);">
                <h3>Atividade</h3>
                <p>Assistência Espiritual e Passe</p>
            </div>
            <div class="linha-voluntario"><label>Dirigente do Trabalho</label><span id="esp-dirigente">--</span></div>
            <div class="linha-voluntario"><label>Sustentação Mediúnica</label><span id="esp-sustentacao">--</span></div>
            <div class="linha-voluntario"><label>Recepção e Apoio</label><span>Equipe de Voluntários</span></div>
        </section>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs, orderBy, limit, Timestamp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBV7RPjk3cFTqL-aIpflJcUojKg1ZXMLuU",
            authDomain: "voluntarios-ativos---cepat.firebaseapp.com",
            projectId: "voluntarios-ativos---cepat",
            storageBucket: "voluntarios-ativos---cepat.firebasestorage.app",
            messagingSenderId: "66122858261",
            appId: "1:66122858261:web:7fa21f1805463b5c08331c"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Atualização de Tempo Real no Monitor
        setInterval(() => {
            const agora = new Date();
            document.getElementById('display-hora').innerText = agora.toLocaleTimeString('pt-BR');
            document.getElementById('display-data').innerText = agora.toLocaleDateString('pt-BR', { weekday: 'long', day: '2-digit', month: 'long' });
        }, 1000);

        async function sincronizarPainel() {
            try {
                const hoje = Timestamp.now();
                
                // Busca Escala Cáritas
                const qSoc = query(collection(db, "escalaCaritas"), where("dataTrabalho", ">=", hoje), orderBy("dataTrabalho", "asc"), limit(1));
                const snapSoc = await getDocs(qSoc);

                if (!snapSoc.empty) {
                    const d = snapSoc.docs[0].data();
                    const eq = d.equipe || d;
                    document.getElementById('caritas-tema').innerText = d.tema || "A definir";
                    document.getElementById('caritas-preletor').innerText = eq.preletor || "A definir";
                    document.getElementById('caritas-entrevistador').innerText = eq.entrevistador || "A definir";
                    
                    const apoio = [(eq.escolaPais || ""), ...(eq.evangelizadores || [])].filter(n => n).join(' • ');
                    document.getElementById('caritas-apoio').innerText = apoio || "A definir";
                    document.getElementById('aviso-erro').style.display = 'none';
                }

                // Busca Escala Mediúnica (AE/VL)
                const qMed = query(collection(db, "escalaMediunica"), where("data", ">=", hoje), orderBy("data", "asc"), limit(1));
                const snapMed = await getDocs(qMed);

                if (!snapMed.empty) {
                    const dm = snapMed.docs[0].data();
                    document.getElementById('esp-dirigente').innerText = dm.dirigente || "--";
                    document.getElementById('esp-sustentacao').innerText = dm.sustentacao || "--";
                }

            } catch (err) {
                console.error("Erro na leitura:", err);
                document.getElementById('aviso-erro').style.display = 'block';
                document.getElementById('aviso-erro').innerText = "Erro de Permissão: Ajuste as regras de 'read' no Console do Firebase.";
            }
        }

        sincronizarPainel();
        setInterval(sincronizarPainel, 300000); // Atualiza dados a cada 5 minutos
    </script>
</body>
</html>